name: database
on: push
jobs:
  capella-trial:
    runs-on: ubuntu-latest
    environment: capella-trial
    env:
      ADMINISTRATOR_PASSWORD: ${{secrets.ADMINISTRATOR_PASSWORD}}
      API_SECRET: ${{secrets.API_SECRET}}
    steps:
      - uses: actions/checkout@main
      - uses: davidkhala/uv-buildpack@main
        with:
          tests: tests
          test-entry-point: python test_couchbase.py
          extras: couchbase
  duck:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@main
      - uses: davidkhala/uv-buildpack@main
        with:
          tests: tests
          test-entry-point: python test_duckdb.py
          extras: duck
  milvus:
    runs-on: ubuntu-latest
    environment: milvus
    steps:
      - run: curl -sfL https://raw.githubusercontent.com/milvus-io/milvus/master/scripts/standalone_embed.sh -o standalone_embed.sh
      - run: bash standalone_embed.sh start
      - uses: actions/checkout@main
      - uses: davidkhala/uv-buildpack@main
        with:
          tests: tests
          test-entry-point: pytest milvus
          extras: milvus
  sql:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@main
      - uses: davidkhala/uv-buildpack@main
        with:
          tests: tests
          test-entry-point: pytest test_sql.py
          extras: mysql